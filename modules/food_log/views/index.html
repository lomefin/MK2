{% extends "../../../templates/main_template.html" %}


{% block js_requires %}

{% endblock %}
{% block js_activities %}
<script type="text/javascript">
		
	var food = {}
	function update_food_list()
	{
		food_list = $('#food_list')
		food_list.empty();
		for(var key in food)
		{
			var badge = $('<span class="badge badge-success">')
			badge.text(food[key] + " " + key)
			food_list.append(badge)
		}

	}

	function modify(el,food_name)
	{
		var regex_id = /(up|down)_(\d*)/;
		var match = regex_id.exec(el.id);
		if(!match) return;
		
		var id = match[2];
		
		var food_amount_textbox = document.getElementById('food_amount_of_'+id);
		var value = parseInt(food_amount_textbox.value);
		if(match[1] == "up")
			value = value+1;
		else
			value = value - 1;
		if(value < 0) value = 0;
		
		food[food_name] = value;
		food_amount_textbox.value = value;
		update_food_list()
	}
	
	$(function() {
		// Handler for .ready() called.
		var food_source = [{% for food_item in food_items %}"{{food_item.name}}" {%if forloop.last%}{%else%},{%endif%}{%endfor%}];
		var food_selected = function(item, typeahead)
		{
			$('div.food_selector_row').hide()
			$('#row_'+item).show()
		}
		$('#food_selector').change(function()
		{
			selector  = $(this)
			looking_for = selector.val()
			if (looking_for == "") return;
			if($.inArray(looking_for,food_source) == -1)
			{
				selector.val("")
			}
			
		});
		$('#food_selector').typeahead(
		{
			updater:food_selected,
			source: food_source
		})

	});
	
</script>	
{% endblock %}
{% block content %}

<section id="food_selection">
	<div class="page-header">
		<h1>¿Qué comiste ayer?</h1>
	</div>
	<div class="row-fluid">
		<p>Ingresa lo que comiste en el día de ayer</p>
	</div>
	<div class="row-fluid">
		<input type="text" id="food_selector" class="input-block-level" 
			placeholder="Empieza a escribir el nombre de lo que comiste ayer"
			data-provide="typeahead" 
			data-minLength="2"
			data-items="10"
		/>
	</div>
</section>
<form action="" method="post">
	<div class="row-fluid" style="min-height:60px">
		{% for food_item in food_items %}
		<div id="row_{{food_item.name}}"  style="display:none" class="food_selector_row">
			<div class="row-fluid">
				<p>Cuantas {{food_item.unit}}s de {{food_item.name}} en <a href="#" rel="tooltip" data-placement="top" title="Considera desayuno, almuerzo, cena y colación!">total</a> comiste ayer?</p>
			</div>
			<div class="row-fluid">
				<div class="span4 offset4">
					<span class="badge badge-success" id="down_{{food_item.key.id}}" onclick="modify(this,'{{food_item.name}}')"><i class="icon-chevron-down icon-white"></i></span>
					<input type="text" class="input-mini" name="{{ food_item.key.id }}" id="food_amount_of_{{ food_item.key.id }}" value="0" readonly="readonly" />
					<span class="badge badge-success" id="up_{{food_item.key.id}}" onclick="modify(this,'{{food_item.name}}')"><i class="icon-chevron-up icon-white"></i></span>
				</div>
			</div>
		</div>
		{% endfor %}
	</div>
	<h2>Llevas anotado...</h2>
	<div class="row-fluid" id="food_list" style="min-height: 60px">

	</div>
	<div class="row-fluid">
		<input type="submit" class="btn btn-primary btn-large pull-right" value="Listo!" />
	</div>
</form>

{% endblock content %}